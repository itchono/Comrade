<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.9.2" />
<title>Comrade.components.servertools.moderation API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>Comrade.components.servertools.moderation</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">import discord
from discord.ext import commands
import typing

from utils.checks import isOP, op_list, threat_list, isServerOwner
from utils.utilities import role, ufil
from db import collection
from config import cfg


def dynamic_threshold(guild, threshold) -&gt; int:
    &#39;&#39;&#39;
    Required threshold, rounded down to nearest int
    threshold: integer percentage
    &#39;&#39;&#39;
    dec = threshold / 100
    thresh = dec * len(
        [m for m in guild.members if (
            str(m.status) != &#34;offline&#34; and not m.bot)])

    return int(thresh)


async def zahando(channel: discord.TextChannel,
                  num: int = 20,
                  user: discord.User = None):
    &#39;&#39;&#39;
    erases a set number of messages in a context (Default 20)
    &#39;&#39;&#39;
    if user:
        await channel.purge(limit=num,
                            check=lambda m: m.author == user)
    else:
        await channel.purge(limit=num)

class Moderation(commands.Cog):
    def __init__(self, bot):
        self.bot: commands.Bot = bot

    @commands.Cog.listener()
    async def on_typing(self, channel, user, when):
        &#39;&#39;&#39;
        Prepare moderation filters
        &#39;&#39;&#39;
        # If user is a threat, raise shield

    @commands.command()
    @commands.guild_only()
    async def mute(self, ctx: commands.Context, *, member: discord.Member):
        &#39;&#39;&#39;
        Votes to mute a selected user.
        As OP: Mute the user
        &#39;&#39;&#39;
        OP = isOP()(ctx)

        mutedrole = await role(ctx.guild, &#34;Comrade-Mute&#34;)

        user_info = collection(&#34;users&#34;).find_one(ufil(member))
        vm = user_info[&#34;moderation&#34;][&#34;mute-votes&#34;]

        mutereq = collection(
            &#34;servers&#34;).find_one(ctx.guild.id)[&#34;thresholds&#34;][&#34;mute&#34;]

        &#39;&#39;&#39;
        Dynamic mute requirement support
        &#39;&#39;&#39;
        if type(mutereq) == str and &#34;%&#34; in mutereq:
            mutereq = dynamic_threshold(
                ctx.guild, float(mutereq.strip(&#34;%&#34;).strip()))
            await ctx.send(
                f&#34;Dynamic mute threshold equals to {mutereq} online members needed to mute.&#34;)

        decision = &#34;unmute&#34; if mutedrole in member.roles else &#34;mute&#34;

        if ctx.author.id not in vm or OP:

            if not OP:
                collection(&#34;users&#34;).update_one(
                    ufil(member),
                    {&#34;$push&#34;: {&#34;moderation.mute-votes&#34;: ctx.author.id}})

                await ctx.send(
                    f&#34;Vote to {decision} {member.display_name} added. ({len(vm) + 1}/{mutereq} votes)&#34;)

            if len(vm) + 1 &gt;= mutereq or OP:
                if mutedrole in member.roles:
                    roles = member.roles
                    roles.remove(mutedrole)
                    await member.edit(roles=roles)
                    await ctx.send(f&#34;{member.display_name} was unmuted.&#34;)
                else:
                    roles = member.roles
                    roles.append(mutedrole)
                    await member.edit(roles=roles)
                    await ctx.send(f&#34;{member.display_name} was muted.&#34;)

                    # Update perms for muted role
                    for channel in ctx.guild.channels:
                        await channel.set_permissions(
                            mutedrole,
                            send_messages=False, add_reactions=False)

                collection(&#34;users&#34;).update_one(
                    ufil(member),
                    {&#34;$set&#34;: {&#34;moderation.mute-votes&#34;: []}})
        else:
            collection(&#34;users&#34;).update_one(
                    ufil(member),
                    {&#34;$pull&#34;: {&#34;moderation.mute-votes&#34;: ctx.author.id}})

            await ctx.send(
                    f&#34;Vote to {decision} {member.display_name} added. ({len(vm) - 1}/{mutereq} votes)&#34;)

    @commands.command()
    @commands.guild_only()
    async def kick(self, ctx: commands.Context, *, member: discord.Member):
        &#39;&#39;&#39;
        Votes to kick a user from the server.
        &#39;&#39;&#39;
        user_info = collection(&#34;users&#34;).find_one(ufil(member))
        vk = user_info[&#34;moderation&#34;][&#34;kick-votes&#34;]

        kickreq = collection(
            &#34;servers&#34;).find_one(ctx.guild.id)[&#34;thresholds&#34;][&#34;kick&#34;]

        &#39;&#39;&#39;
        Dynamic kick requirement
        &#39;&#39;&#39;
        if type(kickreq) == str and &#34;%&#34; in kickreq:
            kickreq = dynamic_threshold(
                ctx.guild, float(kickreq.strip(&#34;%&#34;).strip()))
            await ctx.send(
                f&#34;Dynamic mute threshold equals to {kickreq} online members needed to mute.&#34;)

        if ctx.author.id not in vk:
            collection(&#34;users&#34;).update_one(
                        ufil(member),
                        {&#34;$push&#34;: {&#34;moderation.kick-votes&#34;: ctx.author.id}})
            await ctx.send(f&#34;Vote to kick {member.display_name} added. ({len(vk) + 1}/{kickreq} votes)&#34;)

            if len(vk) + 1 &gt;= kickreq:

                collection(&#34;users&#34;).update_one(
                    ufil(member),
                    {&#34;$set&#34;: {&#34;moderation.kick-votes&#34;: []}})
                await ctx.guild.kick(member)
                await ctx.send(f&#34;{member.display_name} was kicked.&#34;)

        else:
            collection(&#34;users&#34;).update_one(
                        ufil(member),
                        {&#34;$pull&#34;: {&#34;moderation.kick-votes&#34;: ctx.author.id}})
            await ctx.send(f&#34;Vote to kick {member.display_name} removed. ({len(vk) - 1}/{kickreq} votes)&#34;)

    @commands.command()
    @commands.check(isOP())
    @commands.guild_only()
    async def banword(self, ctx: commands.Context,
                      member: typing.Optional[discord.Member] = None,
                      threshold: typing.Optional[int] = 100, *, word):
        &#39;&#39;&#39;
        Bans a word, with an optional person to ban the word for,
        and a percentage similarity threshold required to trigger.
        If no member is specified, the word is banned for the whole server
        If no threshold is specified, the default threshold is 100
        (exact match required)
        Use \\ to escape arguments
        &#39;&#39;&#39;
        word = word.lstrip(&#34;\\&#34;)  # strip \

        if member:
            user_cfg = collection(&#34;users&#34;).find_one(ufil(member))

            if word in user_cfg[&#34;moderation&#34;][&#34;banned-words&#34;]:
                collection(&#34;users&#34;).update_one(
                    ufil(member),
                    {&#34;$unset&#34;: {f&#34;moderation.banned-words.{word}&#34;: &#34;&#34;}})
                await ctx.send(
                    f&#34;Word has been removed from {member.display_name}&#39;s set of personal banned words.&#34;)

            else:
                collection(&#34;users&#34;).update_one(
                    ufil(member),
                    {&#34;$set&#34;: {f&#34;moderation.banned-words.{word}&#34;: threshold}})
                await ctx.send(
                    f&#34;Word has been added to {member.display_name}&#39;s set of personal banned words.\nActivation threshold: {threshold}%&#34;)

        else:
            server_cfg = collection(&#34;servers&#34;).find_one(ctx.guild.id)

            if word in server_cfg[&#34;global-banned-words&#34;]:
                collection(&#34;servers&#34;).update_one(
                    {&#34;_id&#34;: ctx.guild.id},
                    {&#34;$unset&#34;: {f&#34;global-banned-words.{word}&#34;: &#34;&#34;}})
                await ctx.send(
                    f&#34;Word has been removed from {ctx.guild.name}&#39;s global banned words.&#34;)

            else:
                collection(&#34;servers&#34;).update_one(
                    {&#34;_id&#34;: ctx.guild.id},
                    {&#34;$set&#34;: {f&#34;global-banned-words.{word}&#34;: threshold}})
                await ctx.send(
                    f&#34;Word has been added to {member.display_name}&#39;s set of personal banned words.\nActivation threshold: {threshold}%&#34;)

    @commands.command()
    @commands.check_any(commands.check(isOP()), isServerOwner())
    async def op(self, ctx, *, member: discord.Member):
        &#39;&#39;&#39;
        OPs a member
        &#39;&#39;&#39;
        collection(&#34;users&#34;).update_one(ufil(member), {&#34;$set&#34;: {&#34;OP&#34;: True}})
        op_list.cache_clear()
        await ctx.send(f&#34;{member.display_name} is now OP.&#34;)

    @commands.command()
    @commands.check(isOP())
    async def deop(self, ctx, *, member: discord.Member):
        &#39;&#39;&#39;
        de-OPs a member
        &#39;&#39;&#39;
        collection(&#34;users&#34;).update_one(ufil(member), {&#34;$set&#34;: {&#34;OP&#34;: False}})
        op_list.cache_clear()
        await ctx.send(f&#34;{member.display_name} is no longer OP.&#34;)

    @commands.command()
    @commands.check(isOP())
    async def threat(self, ctx, level: int, *, member: discord.Member):
        &#39;&#39;&#39;
        sets a member&#39;s threat level
        &#39;&#39;&#39;
        collection(
            &#34;users&#34;).update_one(
                ufil(member), {&#34;$set&#34;: {&#34;moderation.threat-level&#34;: level}})
        threat_list.cache_clear()
        await ctx.send(f&#34;{member.display_name} is now threat level `{level}`&#34;)

    @commands.Cog.listener()
    async def on_message(self, message: discord.message):
        if not message.author.bot and message.guild and \
               message.content == &#34;ZA HANDO&#34;:
            args = (message.content.lower()).split()
            amount = 20

            if len(args) &gt; 2 and args[2].isnumeric():
                amount = int(args[2])

            if amount &gt; 200 and not isOP()(await self.bot.get_context(message)):
                await message.channel.send(&#34;No&#34;)
            else:
                duration = collection(
                    &#34;servers&#34;).find_one(
                        message.guild.id)[&#34;durations&#34;][&#34;zahando&#34;]

                froom = &#34;from &#34; + str(message.mentions[0]) if message.mentions else &#34;&#34;

                m = await message.channel.send(
                    f&#34;React with &#39;✋&#39; to purge the channel of {amount} messages {froom}. You have **{duration} seconds** to vote.&#34;,
                    delete_after=duration)

                await m.add_reaction(&#34;✋&#34;)

                voted = [message.author.id]

                def check(reaction, user):

                    voted_already = user.id in voted
                    voted.append(user.id)

                    return reaction.emoji == &#34;✋&#34; and not user.bot and (
                            (reaction.message.id == m.id and not voted_already)
                            or cfg[&#34;Settings&#34;][&#34;development-mode&#34;] == &#34;True&#34;)

                await self.bot.wait_for(
                    &#34;reaction_add&#34;, check=check, timeout=duration)

                await zahando(message.channel, amount, message.mentions[0])</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="Comrade.components.servertools.moderation.dynamic_threshold"><code class="name flex">
<span>def <span class="ident">dynamic_threshold</span></span>(<span>guild, threshold) ‑> int</span>
</code></dt>
<dd>
<div class="desc"><p>Required threshold, rounded down to nearest int
threshold: integer percentage</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def dynamic_threshold(guild, threshold) -&gt; int:
    &#39;&#39;&#39;
    Required threshold, rounded down to nearest int
    threshold: integer percentage
    &#39;&#39;&#39;
    dec = threshold / 100
    thresh = dec * len(
        [m for m in guild.members if (
            str(m.status) != &#34;offline&#34; and not m.bot)])

    return int(thresh)</code></pre>
</details>
</dd>
<dt id="Comrade.components.servertools.moderation.zahando"><code class="name flex">
<span>async def <span class="ident">zahando</span></span>(<span>channel: discord.channel.TextChannel, num: int = 20, user: discord.user.User = None)</span>
</code></dt>
<dd>
<div class="desc"><p>erases a set number of messages in a context (Default 20)</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">async def zahando(channel: discord.TextChannel,
                  num: int = 20,
                  user: discord.User = None):
    &#39;&#39;&#39;
    erases a set number of messages in a context (Default 20)
    &#39;&#39;&#39;
    if user:
        await channel.purge(limit=num,
                            check=lambda m: m.author == user)
    else:
        await channel.purge(limit=num)</code></pre>
</details>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="Comrade.components.servertools.moderation.Moderation"><code class="flex name class">
<span>class <span class="ident">Moderation</span></span>
<span>(</span><span>bot)</span>
</code></dt>
<dd>
<div class="desc"><p>The base class that all cogs must inherit from.</p>
<p>A cog is a collection of commands, listeners, and optional state to
help group commands together. More information on them can be found on
the :ref:<code>ext_commands_cogs</code> page.</p>
<p>When inheriting from this class, the options shown in :class:<code>CogMeta</code>
are equally valid here.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Moderation(commands.Cog):
    def __init__(self, bot):
        self.bot: commands.Bot = bot

    @commands.Cog.listener()
    async def on_typing(self, channel, user, when):
        &#39;&#39;&#39;
        Prepare moderation filters
        &#39;&#39;&#39;
        # If user is a threat, raise shield

    @commands.command()
    @commands.guild_only()
    async def mute(self, ctx: commands.Context, *, member: discord.Member):
        &#39;&#39;&#39;
        Votes to mute a selected user.
        As OP: Mute the user
        &#39;&#39;&#39;
        OP = isOP()(ctx)

        mutedrole = await role(ctx.guild, &#34;Comrade-Mute&#34;)

        user_info = collection(&#34;users&#34;).find_one(ufil(member))
        vm = user_info[&#34;moderation&#34;][&#34;mute-votes&#34;]

        mutereq = collection(
            &#34;servers&#34;).find_one(ctx.guild.id)[&#34;thresholds&#34;][&#34;mute&#34;]

        &#39;&#39;&#39;
        Dynamic mute requirement support
        &#39;&#39;&#39;
        if type(mutereq) == str and &#34;%&#34; in mutereq:
            mutereq = dynamic_threshold(
                ctx.guild, float(mutereq.strip(&#34;%&#34;).strip()))
            await ctx.send(
                f&#34;Dynamic mute threshold equals to {mutereq} online members needed to mute.&#34;)

        decision = &#34;unmute&#34; if mutedrole in member.roles else &#34;mute&#34;

        if ctx.author.id not in vm or OP:

            if not OP:
                collection(&#34;users&#34;).update_one(
                    ufil(member),
                    {&#34;$push&#34;: {&#34;moderation.mute-votes&#34;: ctx.author.id}})

                await ctx.send(
                    f&#34;Vote to {decision} {member.display_name} added. ({len(vm) + 1}/{mutereq} votes)&#34;)

            if len(vm) + 1 &gt;= mutereq or OP:
                if mutedrole in member.roles:
                    roles = member.roles
                    roles.remove(mutedrole)
                    await member.edit(roles=roles)
                    await ctx.send(f&#34;{member.display_name} was unmuted.&#34;)
                else:
                    roles = member.roles
                    roles.append(mutedrole)
                    await member.edit(roles=roles)
                    await ctx.send(f&#34;{member.display_name} was muted.&#34;)

                    # Update perms for muted role
                    for channel in ctx.guild.channels:
                        await channel.set_permissions(
                            mutedrole,
                            send_messages=False, add_reactions=False)

                collection(&#34;users&#34;).update_one(
                    ufil(member),
                    {&#34;$set&#34;: {&#34;moderation.mute-votes&#34;: []}})
        else:
            collection(&#34;users&#34;).update_one(
                    ufil(member),
                    {&#34;$pull&#34;: {&#34;moderation.mute-votes&#34;: ctx.author.id}})

            await ctx.send(
                    f&#34;Vote to {decision} {member.display_name} added. ({len(vm) - 1}/{mutereq} votes)&#34;)

    @commands.command()
    @commands.guild_only()
    async def kick(self, ctx: commands.Context, *, member: discord.Member):
        &#39;&#39;&#39;
        Votes to kick a user from the server.
        &#39;&#39;&#39;
        user_info = collection(&#34;users&#34;).find_one(ufil(member))
        vk = user_info[&#34;moderation&#34;][&#34;kick-votes&#34;]

        kickreq = collection(
            &#34;servers&#34;).find_one(ctx.guild.id)[&#34;thresholds&#34;][&#34;kick&#34;]

        &#39;&#39;&#39;
        Dynamic kick requirement
        &#39;&#39;&#39;
        if type(kickreq) == str and &#34;%&#34; in kickreq:
            kickreq = dynamic_threshold(
                ctx.guild, float(kickreq.strip(&#34;%&#34;).strip()))
            await ctx.send(
                f&#34;Dynamic mute threshold equals to {kickreq} online members needed to mute.&#34;)

        if ctx.author.id not in vk:
            collection(&#34;users&#34;).update_one(
                        ufil(member),
                        {&#34;$push&#34;: {&#34;moderation.kick-votes&#34;: ctx.author.id}})
            await ctx.send(f&#34;Vote to kick {member.display_name} added. ({len(vk) + 1}/{kickreq} votes)&#34;)

            if len(vk) + 1 &gt;= kickreq:

                collection(&#34;users&#34;).update_one(
                    ufil(member),
                    {&#34;$set&#34;: {&#34;moderation.kick-votes&#34;: []}})
                await ctx.guild.kick(member)
                await ctx.send(f&#34;{member.display_name} was kicked.&#34;)

        else:
            collection(&#34;users&#34;).update_one(
                        ufil(member),
                        {&#34;$pull&#34;: {&#34;moderation.kick-votes&#34;: ctx.author.id}})
            await ctx.send(f&#34;Vote to kick {member.display_name} removed. ({len(vk) - 1}/{kickreq} votes)&#34;)

    @commands.command()
    @commands.check(isOP())
    @commands.guild_only()
    async def banword(self, ctx: commands.Context,
                      member: typing.Optional[discord.Member] = None,
                      threshold: typing.Optional[int] = 100, *, word):
        &#39;&#39;&#39;
        Bans a word, with an optional person to ban the word for,
        and a percentage similarity threshold required to trigger.
        If no member is specified, the word is banned for the whole server
        If no threshold is specified, the default threshold is 100
        (exact match required)
        Use \\ to escape arguments
        &#39;&#39;&#39;
        word = word.lstrip(&#34;\\&#34;)  # strip \

        if member:
            user_cfg = collection(&#34;users&#34;).find_one(ufil(member))

            if word in user_cfg[&#34;moderation&#34;][&#34;banned-words&#34;]:
                collection(&#34;users&#34;).update_one(
                    ufil(member),
                    {&#34;$unset&#34;: {f&#34;moderation.banned-words.{word}&#34;: &#34;&#34;}})
                await ctx.send(
                    f&#34;Word has been removed from {member.display_name}&#39;s set of personal banned words.&#34;)

            else:
                collection(&#34;users&#34;).update_one(
                    ufil(member),
                    {&#34;$set&#34;: {f&#34;moderation.banned-words.{word}&#34;: threshold}})
                await ctx.send(
                    f&#34;Word has been added to {member.display_name}&#39;s set of personal banned words.\nActivation threshold: {threshold}%&#34;)

        else:
            server_cfg = collection(&#34;servers&#34;).find_one(ctx.guild.id)

            if word in server_cfg[&#34;global-banned-words&#34;]:
                collection(&#34;servers&#34;).update_one(
                    {&#34;_id&#34;: ctx.guild.id},
                    {&#34;$unset&#34;: {f&#34;global-banned-words.{word}&#34;: &#34;&#34;}})
                await ctx.send(
                    f&#34;Word has been removed from {ctx.guild.name}&#39;s global banned words.&#34;)

            else:
                collection(&#34;servers&#34;).update_one(
                    {&#34;_id&#34;: ctx.guild.id},
                    {&#34;$set&#34;: {f&#34;global-banned-words.{word}&#34;: threshold}})
                await ctx.send(
                    f&#34;Word has been added to {member.display_name}&#39;s set of personal banned words.\nActivation threshold: {threshold}%&#34;)

    @commands.command()
    @commands.check_any(commands.check(isOP()), isServerOwner())
    async def op(self, ctx, *, member: discord.Member):
        &#39;&#39;&#39;
        OPs a member
        &#39;&#39;&#39;
        collection(&#34;users&#34;).update_one(ufil(member), {&#34;$set&#34;: {&#34;OP&#34;: True}})
        op_list.cache_clear()
        await ctx.send(f&#34;{member.display_name} is now OP.&#34;)

    @commands.command()
    @commands.check(isOP())
    async def deop(self, ctx, *, member: discord.Member):
        &#39;&#39;&#39;
        de-OPs a member
        &#39;&#39;&#39;
        collection(&#34;users&#34;).update_one(ufil(member), {&#34;$set&#34;: {&#34;OP&#34;: False}})
        op_list.cache_clear()
        await ctx.send(f&#34;{member.display_name} is no longer OP.&#34;)

    @commands.command()
    @commands.check(isOP())
    async def threat(self, ctx, level: int, *, member: discord.Member):
        &#39;&#39;&#39;
        sets a member&#39;s threat level
        &#39;&#39;&#39;
        collection(
            &#34;users&#34;).update_one(
                ufil(member), {&#34;$set&#34;: {&#34;moderation.threat-level&#34;: level}})
        threat_list.cache_clear()
        await ctx.send(f&#34;{member.display_name} is now threat level `{level}`&#34;)

    @commands.Cog.listener()
    async def on_message(self, message: discord.message):
        if not message.author.bot and message.guild and \
               message.content == &#34;ZA HANDO&#34;:
            args = (message.content.lower()).split()
            amount = 20

            if len(args) &gt; 2 and args[2].isnumeric():
                amount = int(args[2])

            if amount &gt; 200 and not isOP()(await self.bot.get_context(message)):
                await message.channel.send(&#34;No&#34;)
            else:
                duration = collection(
                    &#34;servers&#34;).find_one(
                        message.guild.id)[&#34;durations&#34;][&#34;zahando&#34;]

                froom = &#34;from &#34; + str(message.mentions[0]) if message.mentions else &#34;&#34;

                m = await message.channel.send(
                    f&#34;React with &#39;✋&#39; to purge the channel of {amount} messages {froom}. You have **{duration} seconds** to vote.&#34;,
                    delete_after=duration)

                await m.add_reaction(&#34;✋&#34;)

                voted = [message.author.id]

                def check(reaction, user):

                    voted_already = user.id in voted
                    voted.append(user.id)

                    return reaction.emoji == &#34;✋&#34; and not user.bot and (
                            (reaction.message.id == m.id and not voted_already)
                            or cfg[&#34;Settings&#34;][&#34;development-mode&#34;] == &#34;True&#34;)

                await self.bot.wait_for(
                    &#34;reaction_add&#34;, check=check, timeout=duration)

                await zahando(message.channel, amount, message.mentions[0])</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>discord.ext.commands.cog.Cog</li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="Comrade.components.servertools.moderation.Moderation.banword"><code class="name">var <span class="ident">banword</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="Comrade.components.servertools.moderation.Moderation.deop"><code class="name">var <span class="ident">deop</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="Comrade.components.servertools.moderation.Moderation.kick"><code class="name">var <span class="ident">kick</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="Comrade.components.servertools.moderation.Moderation.mute"><code class="name">var <span class="ident">mute</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="Comrade.components.servertools.moderation.Moderation.op"><code class="name">var <span class="ident">op</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="Comrade.components.servertools.moderation.Moderation.threat"><code class="name">var <span class="ident">threat</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="Comrade.components.servertools.moderation.Moderation.on_message"><code class="name flex">
<span>async def <span class="ident">on_message</span></span>(<span>self, message: <module 'discord.message' from 'c:\\python38\\lib\\site-packages\\discord\\message.py'>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@commands.Cog.listener()
async def on_message(self, message: discord.message):
    if not message.author.bot and message.guild and \
           message.content == &#34;ZA HANDO&#34;:
        args = (message.content.lower()).split()
        amount = 20

        if len(args) &gt; 2 and args[2].isnumeric():
            amount = int(args[2])

        if amount &gt; 200 and not isOP()(await self.bot.get_context(message)):
            await message.channel.send(&#34;No&#34;)
        else:
            duration = collection(
                &#34;servers&#34;).find_one(
                    message.guild.id)[&#34;durations&#34;][&#34;zahando&#34;]

            froom = &#34;from &#34; + str(message.mentions[0]) if message.mentions else &#34;&#34;

            m = await message.channel.send(
                f&#34;React with &#39;✋&#39; to purge the channel of {amount} messages {froom}. You have **{duration} seconds** to vote.&#34;,
                delete_after=duration)

            await m.add_reaction(&#34;✋&#34;)

            voted = [message.author.id]

            def check(reaction, user):

                voted_already = user.id in voted
                voted.append(user.id)

                return reaction.emoji == &#34;✋&#34; and not user.bot and (
                        (reaction.message.id == m.id and not voted_already)
                        or cfg[&#34;Settings&#34;][&#34;development-mode&#34;] == &#34;True&#34;)

            await self.bot.wait_for(
                &#34;reaction_add&#34;, check=check, timeout=duration)

            await zahando(message.channel, amount, message.mentions[0])</code></pre>
</details>
</dd>
<dt id="Comrade.components.servertools.moderation.Moderation.on_typing"><code class="name flex">
<span>async def <span class="ident">on_typing</span></span>(<span>self, channel, user, when)</span>
</code></dt>
<dd>
<div class="desc"><p>Prepare moderation filters</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@commands.Cog.listener()
async def on_typing(self, channel, user, when):
    &#39;&#39;&#39;
    Prepare moderation filters
    &#39;&#39;&#39;</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="Comrade.components.servertools" href="index.html">Comrade.components.servertools</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="Comrade.components.servertools.moderation.dynamic_threshold" href="#Comrade.components.servertools.moderation.dynamic_threshold">dynamic_threshold</a></code></li>
<li><code><a title="Comrade.components.servertools.moderation.zahando" href="#Comrade.components.servertools.moderation.zahando">zahando</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="Comrade.components.servertools.moderation.Moderation" href="#Comrade.components.servertools.moderation.Moderation">Moderation</a></code></h4>
<ul class="two-column">
<li><code><a title="Comrade.components.servertools.moderation.Moderation.banword" href="#Comrade.components.servertools.moderation.Moderation.banword">banword</a></code></li>
<li><code><a title="Comrade.components.servertools.moderation.Moderation.deop" href="#Comrade.components.servertools.moderation.Moderation.deop">deop</a></code></li>
<li><code><a title="Comrade.components.servertools.moderation.Moderation.kick" href="#Comrade.components.servertools.moderation.Moderation.kick">kick</a></code></li>
<li><code><a title="Comrade.components.servertools.moderation.Moderation.mute" href="#Comrade.components.servertools.moderation.Moderation.mute">mute</a></code></li>
<li><code><a title="Comrade.components.servertools.moderation.Moderation.on_message" href="#Comrade.components.servertools.moderation.Moderation.on_message">on_message</a></code></li>
<li><code><a title="Comrade.components.servertools.moderation.Moderation.on_typing" href="#Comrade.components.servertools.moderation.Moderation.on_typing">on_typing</a></code></li>
<li><code><a title="Comrade.components.servertools.moderation.Moderation.op" href="#Comrade.components.servertools.moderation.Moderation.op">op</a></code></li>
<li><code><a title="Comrade.components.servertools.moderation.Moderation.threat" href="#Comrade.components.servertools.moderation.Moderation.threat">threat</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.9.2</a>.</p>
</footer>
</body>
</html>